
 <!DOCTYPE html>
 <html>
   <head>
     <title>Sample page</title>
    <link rel="stylesheet" type="text/css" href="hoja.css">
   </head>
   <body><p class = "KEYWORDS">using</p> <p class = "KEYWORDS">namespace</p> <p class = "ID">std</p>;<br/><br/><p class = "DIRECTIVAS">#include</p> <p class = "OPERADORES"><</p><p class = "ID">sys</p><p class = "OPERADORES">/</p><p class = "ID">types</p>.<p class = "ID">h</p><p class = "OPERADORES">></p><br/><p class = "DIRECTIVAS">#include</p> <p class = "OPERADORES"><</p><p class = "ID">sys</p><p class = "OPERADORES">/</p><p class = "ID">socket</p>.<p class = "ID">h</p><p class = "OPERADORES">></p><br/><p class = "DIRECTIVAS">#include</p> <p class = "OPERADORES"><</p><p class = "ID">arpa</p><p class = "OPERADORES">/</p><p class = "ID">inet</p>.<p class = "ID">h</p><p class = "OPERADORES">></p><br/><p class = "DIRECTIVAS">#include</p> <p class = "OPERADORES"><</p><p class = "ID">netinet</p><p class = "OPERADORES">/</p><p class = "ID">in</p>.<p class = "ID">h</p><p class = "OPERADORES">></p><br/><p class = "DIRECTIVAS">#include</p> <p class = "CADENAS">"SocketDatagrama.h"</p><br/><p class = "DIRECTIVAS">#include</p> <p class = "CADENAS">"PaqueteDatagrama.h"</p><br/><br/><p class = "DIRECTIVAS">#define</p> <p class = "ID">MAXPARALLELTRHEADS</p>  <p class = "NUMERICOS">100</p><br/><p class = "DIRECTIVAS">#define</p> <p class = "ID">SVRPORT</p>             <p class = "NUMERICOS">7200</p><br/><p class = "DIRECTIVAS">#define</p> <p class = "ID">MAX_RETRIES</p>         <p class = "NUMERICOS">3</p><br/><p class = "DIRECTIVAS">#define</p> <p class = "ID">TIMEOUT_SECONDS</p>     <p class = "NUMERICOS">1</p><br/><p class = "DIRECTIVAS">#define</p> <p class = "ID">TIMEOUT_USECONDS</p>    <p class = "NUMERICOS">0</p><br/><br/><p class = "KEYWORDS">vector</p><p class = "OPERADORES"><</p><p class = "TIPOSDATO">uint32_t</p><p class = "OPERADORES">></p> <p class = "ID">foundSvrs</p>;<br/><br/><p class = "TIPOSDATO">uint32_t</p> <p class = "ID">parseIPv4string</p>(<p class = "KEYWORDS">const</p> <p class = "ID">std</p><p class = "OPERADORES">::</p><p class = "ID">string</p> <p class = "OPERADORES">&</p><p class = "ID">IPv4</p>){<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">unsigned</p> <p class = "TIPOSDATO">short</p> <p class = "ID">addr</p>[<p class = "NUMERICOS">4</p>];<br/><p class = "tab">Tab</p><p class = "KEYWORDS">if</p>(<p class = "ID">sscanf</p>(<p class = "ID">IPv4</p>.<p class = "ID">c_str</p>(), <p class = "CADENAS">"%hu.%hu.%hu.%hu"</p>, <p class = "OPERADORES">&</p><p class = "ID">addr</p>[<p class = "NUMERICOS">0</p>], <p class = "OPERADORES">&</p><p class = "ID">addr</p>[<p class = "NUMERICOS">1</p>], <p class = "OPERADORES">&</p><p class = "ID">addr</p>[<p class = "NUMERICOS">2</p>], <p class = "OPERADORES">&</p><p class = "ID">addr</p>[<p class = "NUMERICOS">3</p>])<p class = "OPERADORES">!=</p><p class = "NUMERICOS">4</p>){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> <p class = "NUMERICOS">0</p>;<br/><p class = "tab">Tab</p>}<p class = "KEYWORDS">else</p>{<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> (<p class = "TIPOSDATO">uint32_t</p>)(<p class = "ID">addr</p>[<p class = "NUMERICOS">3</p>] <p class = "OPERADORES">+</p> <p class = "ID">addr</p>[<p class = "NUMERICOS">2</p>]<p class = "OPERADORES">/</p><p class = "ID_MAL">0x100</p> <p class = "OPERADORES">+</p> <p class = "ID">addr</p>[<p class = "NUMERICOS">1</p>]<p class = "OPERADORES">/</p><p class = "ID_MAL">0x10000ul</p> <p class = "OPERADORES">+</p> <p class = "ID">addr</p>[<p class = "NUMERICOS">0</p>]<p class = "OPERADORES">/</p><p class = "ID_MAL">0x1000000ul</p>);<br/><p class = "tab">Tab</p>}<br/>}<br/><br/><p class = "TIPOSDATO">size_t</p> <p class = "ID">parseIPv4int</p>(<p class = "TIPOSDATO">char</p> <p class = "ID">IPv4str</p>, <p class = "TIPOSDATO">uint32_t</p> <p class = "ID">IPv4int</p>){<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">size_t</p> <p class = "ID">lgth</p>;<br/><p class = "tab">Tab</p><p class = "ID">lgth</p> <p class = "OPERADORES">=</p> <p class = "ID">sprintf</p>(<p class = "ID">IPv4str</p>, <p class = "CADENAS">"%u.%u.%u.%u"</p>, <p class = "ID">IPv4int</p><p class = "OPERADORES">>></p><p class = "NUMERICOS">24</p> <p class = "OPERADORES">&</p> <p class = "ID_MAL">0xFF</p>, <p class = "ID">IPv4int</p><p class = "OPERADORES">>></p><p class = "NUMERICOS">16</p> <p class = "OPERADORES">&</p> <p class = "ID_MAL">0xFF</p>, <p class = "ID">IPv4int</p><p class = "OPERADORES">>></p><p class = "NUMERICOS">8</p> <p class = "OPERADORES">&</p> <p class = "ID_MAL">0xFF</p>, <p class = "ID">IPv4int</p> <p class = "OPERADORES">&</p> <p class = "ID_MAL">0xFF</p>);<br/><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> <p class = "ID">lgth</p>;<br/>}<br/><br/><p class = "TIPOSDATO">uint32_t</p> <p class = "ID">getBroadcastAddr</p>(<p class = "TIPOSDATO">uint32_t</p> <p class = "ID">mask</p>, <p class = "TIPOSDATO">uint32_t</p> <p class = "ID">net</p>){<br/><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> ((<p class = "OPERADORES">~</p><p class = "ID">mask</p>) <p class = "OPERADORES">|</p> <p class = "ID">net</p>);<br/>}<br/><br/><p class = "TIPOSDATO">uint32_t</p> <p class = "ID">getNextIPv4Addr</p>(<p class = "TIPOSDATO">uint32_t</p> <p class = "ID">ip</p>, <p class = "TIPOSDATO">uint32_t</p> <p class = "ID">mask</p>, <p class = "TIPOSDATO">uint32_t</p> <p class = "ID">net</p>, <p class = "TIPOSDATO">size_t</p> <p class = "ID">add</p>){<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">uint32_t</p> <p class = "ID">next</p> <p class = "OPERADORES">=</p> ((<p class = "ID">ip</p> <p class = "OPERADORES">&</p> <p class = "ID">mask</p>) <p class = "OPERADORES">|</p> ((<p class = "ID">ip</p> <p class = "OPERADORES">+</p> <p class = "ID">add</p>) <p class = "OPERADORES">&</p> <p class = "OPERADORES">~</p><p class = "ID">mask</p>)); <br/><p class = "tab">Tab</p><p class = "KEYWORDS">if</p>(<p class = "ID">next</p><p class = "OPERADORES">==</p><p class = "ID">net</p>){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> <p class = "ID">getNextIPv4Addr</p>(<p class = "ID">next</p>, <p class = "ID">mask</p>, <p class = "ID">net</p>, <p class = "NUMERICOS">1</p>);<br/><p class = "tab">Tab</p>}<p class = "KEYWORDS">else</p> <p class = "KEYWORDS">if</p>(<p class = "ID">next</p><p class = "OPERADORES">==</p><p class = "ID">getBroadcastAddr</p>(<p class = "ID">mask</p>, <p class = "ID">net</p>)){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> <p class = "ID">getNextIPv4Addr</p>(<p class = "ID">next</p>, <p class = "ID">mask</p>, <p class = "ID">net</p>, <p class = "NUMERICOS">1</p>);<br/><p class = "tab">Tab</p>}<p class = "KEYWORDS">else</p>{<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> <p class = "ID">next</p>;<br/><p class = "tab">Tab</p>}<br/>}<br/><br/><p class = "TIPOSDATO">void</p> <p class = "ID">checkSvrConnection</p>(<p class = "TIPOSDATO">int</p> <p class = "ID">a</p>, <p class = "TIPOSDATO">int</p> <p class = "ID">b</p>, <p class = "TIPOSDATO">uint32_t</p> <p class = "ID">svrAddr</p>, <p class = "TIPOSDATO">unsigned</p> <p class = "TIPOSDATO">short</p> <p class = "ID">svrPort</p>){<br/><p class = "tab">Tab</p><p class = "ID">SocketDatagrama</p> <p class = "ID">socketlocal</p> <p class = "OPERADORES">=</p> <p class = "ID">new</p> <p class = "ID">SocketDatagrama</p>();<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">int</p> <p class = "ID">retry</p> <p class = "OPERADORES">=</p> <p class = "NUMERICOS">0</p>, <p class = "ID">res</p> <p class = "OPERADORES">=</p> <p class = "NUMERICOS">0</p>, <p class = "ID">buff</p>[<p class = "NUMERICOS">2</p>];<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">char</p> <p class = "ID">svrAddrStr</p>[<p class = "NUMERICOS">16</p>];<br/>    <br/><p class = "tab">Tab</p><p class = "ID">parseIPv4int</p>(<p class = "ID">svrAddrStr</p>, <p class = "ID">svrAddr</p>);<br/><p class = "tab">Tab</p><p class = "ID">buff</p>[<p class = "NUMERICOS">0</p>] <p class = "OPERADORES">=</p> <p class = "ID">a</p>, <p class = "ID">buff</p>[<p class = "NUMERICOS">1</p>] <p class = "OPERADORES">=</p> <p class = "ID">b</p>;<br/><p class = "tab">Tab</p><p class = "COMENTARIOS">/*begin transmission*/</p><br/><p class = "tab">Tab</p><p class = "ID">PaqueteDatagrama</p> <p class = "ID">sndPkt</p>(<p class = "ID">buff</p>, <p class = "KEYWORDS">sizeof</p>(<p class = "TIPOSDATO">int</p>)<p class = "OPERADORES">/</p><p class = "NUMERICOS">2</p>, <p class = "ID">svrAddrStr</p>, <p class = "ID">svrPort</p>);<br/><p class = "tab">Tab</p><p class = "ID">PaqueteDatagrama</p> <p class = "ID">recvPkt</p>(<p class = "KEYWORDS">sizeof</p>(<p class = "TIPOSDATO">int</p>));<br/><p class = "tab">Tab</p><p class = "KEYWORDS">while</p>(<p class = "ID">retry</p><p class = "OPERADORES"><</p><p class = "ID">MAX_RETRIES</p>){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "COMENTARIOS">/*sends packet*/</p><br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">socketlocal</p><p class = "OPERADORES">-</p><p class = "OPERADORES">></p><p class = "ID">send</p>(<p class = "ID">sndPkt</p>);<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "COMENTARIOS">/*waits for server to answer*/</p><br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">if</p>(<p class = "ID">socketlocal</p><p class = "OPERADORES">-</p><p class = "OPERADORES">></p><p class = "ID">receiveTimeout</p>(<p class = "ID">recvPkt</p>, <p class = "ID">TIMEOUT_SECONDS</p>, <p class = "ID">TIMEOUT_USECONDS</p>)<p class = "OPERADORES">></p><p class = "NUMERICOS">0</p> <p class = "OPERADORES">&&</p> <p class = "ID">recvPkt</p>.<p class = "ID">getPort</p>()<p class = "OPERADORES">==</p><p class = "ID">svrPort</p> <p class = "OPERADORES">&&</p> <p class = "ID">svrAddr</p><p class = "OPERADORES">==</p><p class = "ID">parseIPv4string</p>(<p class = "ID">recvPkt</p>.<p class = "ID">getAddr</p>())){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">memcpy</p>(<p class = "OPERADORES">&</p><p class = "ID">res</p>, <p class = "ID">recvPkt</p>.<p class = "ID">getData</p>(), <p class = "KEYWORDS">sizeof</p>(<p class = "TIPOSDATO">int</p>));<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">if</p>(<p class = "ID">res</p><p class = "OPERADORES">==</p>(<p class = "ID">a</p> <p class = "OPERADORES">+</p> <p class = "ID">b</p>)){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">foundSvrs</p>.<p class = "ID">push_back</p>(<p class = "ID">parseIPv4string</p>(<p class = "ID">recvPkt</p>.<p class = "ID">getAddr</p>()));<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p>}<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">break</p>;<br/><p class = "tab">Tab</p><p class = "tab">Tab</p>}<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">retry</p><p class = "OPERADORES">++</p>;<br/><p class = "tab">Tab</p>}<br/>}<br/><br/><p class = "TIPOSDATO">int</p> <p class = "ID">main</p>(<p class = "TIPOSDATO">int</p> <p class = "ID">agrc</p>, <p class = "TIPOSDATO">char</p> <p class = "ID">argv</p>[]){<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">int</p> <p class = "ID">i</p>, <p class = "ID">j</p>;<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">int</p> <p class = "ID">data</p>[<p class = "NUMERICOS">2</p>] <p class = "OPERADORES">=</p> { <p class = "NUMERICOS">5</p>, <p class = "NUMERICOS">2</p> };<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">uint32_t</p> <p class = "ID">svrAddr</p>, <p class = "ID">fin</p>;<br/><p class = "tab">Tab</p><p class = "TIPOSDATO">uint32_t</p> <p class = "ID">net</p> <p class = "OPERADORES">=</p> <p class = "ID">parseIPv4string</p>(<p class = "ID">argv</p>[<p class = "NUMERICOS">1</p>]), <p class = "ID">mask</p> <p class = "OPERADORES">=</p> <p class = "ID">parseIPv4string</p>(<p class = "ID">argv</p>[<p class = "NUMERICOS">2</p>]);<br/>    <br/><p class = "tab">Tab</p><p class = "ID">svrAddr</p> <p class = "OPERADORES">=</p> <p class = "ID">parseIPv4string</p>(<p class = "CADENAS">"10.100.77.0"</p>);<br/><p class = "tab">Tab</p><p class = "ID">fin</p> <p class = "OPERADORES">=</p> <p class = "ID">parseIPv4string</p>(<p class = "CADENAS">"10.100.80.0"</p>);<br/><p class = "tab">Tab</p><p class = "ID">fin</p> <p class = "OPERADORES">=</p> <p class = "ID">getNextIPv4Addr</p>(<p class = "ID">fin</p>, <p class = "ID">mask</p>, <p class = "ID">net</p>, <p class = "NUMERICOS">1</p>);<br/><p class = "tab">Tab</p><p class = "ID">thread</p> <p class = "ID">th</p>[<p class = "ID">MAXPARALLELTRHEADS</p>];<br/><p class = "tab">Tab</p><p class = "KEYWORDS">do</p>{<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">for</p>(<p class = "ID">i</p> <p class = "OPERADORES">=</p> <p class = "NUMERICOS">0</p>; <p class = "ID">i</p><p class = "OPERADORES"><</p><p class = "ID">MAXPARALLELTRHEADS</p>; <p class = "ID">i</p><p class = "OPERADORES">++</p>){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">th</p>[<p class = "ID">i</p>] <p class = "OPERADORES">=</p> <p class = "ID">thread</p>(<p class = "ID">checkSvrConnection</p>, <p class = "ID">data</p>[<p class = "NUMERICOS">0</p>], <p class = "ID">data</p>[<p class = "NUMERICOS">1</p>], <p class = "ID">svrAddr</p>, <p class = "ID">SVRPORT</p>);<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">svrAddr</p> <p class = "OPERADORES">=</p> <p class = "ID">getNextIPv4Addr</p>(<p class = "ID">svrAddr</p>, <p class = "ID">mask</p>, <p class = "ID">net</p>, <p class = "NUMERICOS">1</p>);<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">if</p>(<p class = "ID">svrAddr</p><p class = "OPERADORES">==</p><p class = "ID">fin</p>){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">i</p><p class = "OPERADORES">++</p>;<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">break</p>;<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p>}<br/><p class = "tab">Tab</p><p class = "tab">Tab</p>}<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "KEYWORDS">for</p>(<p class = "ID">j</p> <p class = "OPERADORES">=</p> <p class = "NUMERICOS">0</p>; <p class = "ID">j</p><p class = "OPERADORES"><</p><p class = "ID">i</p>; <p class = "ID">j</p><p class = "OPERADORES">++</p>){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">th</p>[<p class = "ID">j</p>].<p class = "ID">join</p>();<br/><p class = "tab">Tab</p><p class = "tab">Tab</p>}<br/><p class = "tab">Tab</p>}<p class = "KEYWORDS">while</p>(<p class = "ID">svrAddr</p><p class = "OPERADORES">!=</p><p class = "ID">fin</p>);<br/><br/><p class = "tab">Tab</p><p class = "KEYWORDS">for</p>(<p class = "ID">i</p> <p class = "OPERADORES">=</p> <p class = "NUMERICOS">0</p>; <p class = "ID">i</p><p class = "OPERADORES"><</p><p class = "ID">foundSvrs</p>.<p class = "ID">size</p>(); <p class = "ID">i</p><p class = "OPERADORES">++</p>){<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "TIPOSDATO">char</p> <p class = "ID">addr</p>[<p class = "NUMERICOS">16</p>];<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">parseIPv4int</p>(<p class = "ID">addr</p>, <p class = "ID">foundSvrs</p>[<p class = "ID">i</p>]);<br/><p class = "tab">Tab</p><p class = "tab">Tab</p><p class = "ID">printf</p>(<p class = "CADENAS">"\t%s\n"</p>, <p class = "ID">addr</p>);<br/><p class = "tab">Tab</p>}<br/><p class = "tab">Tab</p><p class = "KEYWORDS">return</p> <p class = "NUMERICOS">0</p>;<br/>}<br/>
   </body>
 </html>