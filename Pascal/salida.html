
 <!DOCTYPE html>
 <html>
   <head>
     <title>Sample page</title>
    <link rel="stylesheet" type="text/css" href="ejemplo.css">
   </head>
   <body><p class = "libreria">#include</p> <p class = "constantechar">"header.h"</p><br/><p class = "libreria">#include</p> <p class = "operador"><</p><p class = "ids">sys</p><p class = "operador">/</p><p class = "ids">stat</p><p class = "sinClass">.</p><p class = "ids">h</p><p class = "operador">></p><br/><p class = "libreria">#include</p> <p class = "operador"><</p><p class = "ids">fcntl</p><p class = "sinClass">.</p><p class = "ids">h</p><p class = "operador">></p><br/><p class = "libreria">#include</p> <p class = "operador"><</p><p class = "ids">sys</p><p class = "operador">/</p><p class = "ids">types</p><p class = "sinClass">.</p><p class = "ids">h</p><p class = "operador">></p><br/><p class = "libreria">#include</p> <p class = "operador"><</p><p class = "ids">iostream</p><p class = "operador">></p><br/><p class = "libreria">#include</p> <p class = "operador"><</p><p class = "ids">stdlib</p><p class = "sinClass">.</p><p class = "ids">h</p><p class = "operador">></p><br/><p class = "libreria">#include</p> <p class = "operador"><</p><p class = "ids">unistd</p><p class = "sinClass">.</p><p class = "ids">h</p><p class = "operador">></p><br/><p class = "libreria">#include</p> <p class = "constantechar">"SocketDatagrama.h"</p><br/><p class = "libreria">#include</p> <p class = "constantechar">"PaqueteDatagrama.h"</p><br/><br/><p class = "reservada">using</p> <p class = "reservada">namespace</p> <p class = "ids">std</p><p class = "simbolo">;</p><br/><br/><p class = "tipodato">int</p> <p class = "ids">rdonly_File</p><p class = "simbolo">(</p><p class = "tipodato">char</p> <p class = "sinClass">*</p><p class = "ids">name</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/><p class = "tipodato">int</p> <p class = "ids">wronly_File</p><p class = "simbolo">(</p><p class = "tipodato">char</p> <p class = "sinClass">*</p><p class = "ids">name</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/><p class = "tipodato">int</p> <p class = "ids">create_File</p><p class = "simbolo">(</p><p class = "tipodato">char</p> <p class = "sinClass">*</p><p class = "ids">name</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/><br/><p class = "tipodato">struct</p> <p class = "ids">mensaje</p> <p class = "ids">msg</p><p class = "simbolo">;</p><br/><br/><p class = "tipodato">int</p> <p class = "main">main</p><p class = "simbolo">(</p><p class = "tipodato">int</p> <p class = "ids">argc</p><p class = "simbolo">,</p> <p class = "tipodato">char</p> <p class = "sinClass">*</p><p class = "ids">argv</p><p class = "sinClass">[</p><p class = "sinClass">]</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>    <p class = "ids">SocketDatagrama</p> <p class = "ids">socket</p><p class = "simbolo">;</p><br/>    <p class = "tipodato">int</p> <p class = "ids">id_File</p><p class = "simbolo">,</p> <p class = "ids">nbytes</p> <p class = "operador">=</p> <p class = "numero">0</p><p class = "simbolo">;</p><br/>    <p class = "tipodato">char</p> <p class = "ids">ip_Server</p><p class = "sinClass">[</p><p class = "numero">19</p><p class = "sinClass">]</p><p class = "simbolo">;</p><br/>    <p class = "reservada">if</p><p class = "simbolo">(</p><p class = "ids">argc</p> <p class = "operador"><</p> <p class = "numero">3</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>                <p class = "ids">perror</p><p class = "simbolo">(</p><p class = "constantechar">"Parametros: [ARCHIVO] [IP_SERVER]"</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>                <p class = "ids">exit</p><p class = "simbolo">(</p><p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/><p class = "tab">Tab</p><p class = "simbolo">}</p><br/>    <p class = "ids">strcpy</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">name</p><p class = "simbolo">,</p> <p class = "ids">argv</p><p class = "sinClass">[</p><p class = "numero">2</p><p class = "sinClass">]</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "ids">strcpy</p><p class = "simbolo">(</p><p class = "ids">ip_Server</p><p class = "simbolo">,</p> <p class = "ids">argv</p><p class = "sinClass">[</p><p class = "numero">1</p><p class = "sinClass">]</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "operador">/</p><p class = "operador">/</p><p class = "ids">INDICA</p> <p class = "ids">AL</p> <p class = "ids">SERVIDOR</p> <p class = "ids">QUE</p> <p class = "ids">DEBE</p> <p class = "ids">CREAR</p> <p class = "ids">UN</p> <p class = "ids">ARCHIVO</p><br/>    <p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p> <p class = "operador">=</p> <p class = "ids">CREATE</p><p class = "simbolo">;</p><br/>    <p class = "ids">PaqueteDatagrama</p> <p class = "ids">crt</p><p class = "simbolo">(</p><p class = "sinClass">&</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p><p class = "simbolo">,</p> <p class = "reservada">sizeof</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p><p class = "simbolo">)</p><p class = "simbolo">,</p> <p class = "ids">ip_Server</p><p class = "simbolo">,</p> <p class = "ids">PUERTO</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "ids">socket</p><p class = "sinClass">.</p><p class = "ids">envia</p><p class = "simbolo">(</p><p class = "ids">crt</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "operador">/</p><p class = "operador">/</p><p class = "ids">ENVIA</p> <p class = "ids">EL</p> <p class = "ids">NOMBRE</p> <p class = "ids">DEL</p> <p class = "ids">ARCHIVO</p> <p class = "ids">AL</p> <p class = "ids">SERVIDOR</p><br/>    <p class = "ids">PaqueteDatagrama</p> <p class = "ids">nombre</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">name</p><p class = "simbolo">,</p> <p class = "ids">MAX_PATH</p><p class = "simbolo">,</p> <p class = "ids">ip_Server</p><p class = "simbolo">,</p> <p class = "ids">PUERTO</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "ids">socket</p><p class = "sinClass">.</p><p class = "ids">envia</p><p class = "simbolo">(</p><p class = "ids">nombre</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "operador">/</p><p class = "operador">/</p><p class = "ids">INDICA</p> <p class = "ids">AL</p> <p class = "ids">SERVIDOR</p> <p class = "ids">QUE</p> <p class = "ids">DEBE</p> <p class = "ids">CREAR</p> <p class = "ids">UN</p> <p class = "ids">ARCHIVO</p><br/>    <p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p> <p class = "operador">=</p> <p class = "ids">WRITE</p><p class = "simbolo">;</p><br/>    <p class = "ids">PaqueteDatagrama</p> <p class = "ids">wrt</p><p class = "simbolo">(</p><p class = "sinClass">&</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p><p class = "simbolo">,</p> <p class = "reservada">sizeof</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p><p class = "simbolo">)</p><p class = "simbolo">,</p> <p class = "ids">ip_Server</p><p class = "simbolo">,</p> <p class = "ids">PUERTO</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "ids">socket</p><p class = "sinClass">.</p><p class = "ids">envia</p><p class = "simbolo">(</p><p class = "ids">wrt</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "operador">/</p><p class = "operador">/</p><p class = "ids">ABRE</p> <p class = "ids">EL</p> <p class = "ids">ARCHIVO</p> <p class = "ids">EN</p> <p class = "ids">MODO</p> <p class = "ids">LECTURA</p><br/>    <p class = "ids">id_File</p> <p class = "operador">=</p> <p class = "ids">rdonly_File</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">name</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "operador">/</p><p class = "operador">/</p><p class = "ids">ENVIA</p> <p class = "ids">EL</p> <p class = "ids">BUFFER</p> <p class = "ids">DE</p> <p class = "ids">DATOS</p><br/>    <p class = "ids">while</p> <p class = "simbolo">(</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">count</p> <p class = "operador">=</p> <p class = "ids">read</p><p class = "simbolo">(</p><p class = "ids">id_File</p><p class = "simbolo">,</p> <p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">data</p><p class = "simbolo">,</p> <p class = "ids">BUFF_SIZE</p><p class = "simbolo">)</p><p class = "simbolo">)</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>        <p class = "ids">PaqueteDatagrama</p> <p class = "ids">info</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">data</p><p class = "simbolo">,</p> <p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">count</p><p class = "simbolo">,</p> <p class = "ids">ip_Server</p><p class = "simbolo">,</p> <p class = "ids">PUERTO</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>        <p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">count</p> <p class = "operador">=</p> <p class = "ids">socket</p><p class = "sinClass">.</p><p class = "ids">envia</p><p class = "simbolo">(</p><p class = "ids">info</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>        <p class = "ids">nbytes</p> <p class = "operador">+</p><p class = "operador">=</p> <p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">count</p><p class = "simbolo">;</p><br/>        <p class = "reservada">if</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">count</p> <p class = "operador">==</p> <p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>            <p class = "ids">perror</p><p class = "simbolo">(</p><p class = "constantechar">"Ocurrio un error\n"</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>            <p class = "ids">exit</p><p class = "simbolo">(</p><p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>        <p class = "simbolo">}</p><br/>    <p class = "simbolo">}</p><br/>    <p class = "ids">cout</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "constantechar">"\tSe enviaron "</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "ids">nbytes</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "constantechar">" bytes de datos\n"</p><p class = "simbolo">;</p><br/>    <p class = "ids">cout</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "constantechar">"Transmision finalizada\n"</p><p class = "simbolo">;</p><br/>    <p class = "operador">/</p><p class = "operador">/</p><p class = "ids">INDICA</p> <p class = "ids">AL</p> <p class = "ids">SERVIDOR</p> <p class = "ids">QUE</p> <p class = "ids">LA</p> <p class = "ids">OPERACION</p> <p class = "ids">TUVO</p> <p class = "ids">EXITO</p><br/>    <p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p> <p class = "operador">=</p> <p class = "ids">OK</p><p class = "simbolo">;</p><br/>    <p class = "ids">PaqueteDatagrama</p> <p class = "ids">ok</p><p class = "simbolo">(</p><p class = "sinClass">&</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p><p class = "simbolo">,</p> <p class = "reservada">sizeof</p><p class = "simbolo">(</p><p class = "ids">msg</p><p class = "sinClass">.</p><p class = "ids">opcode</p><p class = "simbolo">)</p><p class = "simbolo">,</p> <p class = "ids">ip_Server</p><p class = "simbolo">,</p> <p class = "ids">PUERTO</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "ids">socket</p><p class = "sinClass">.</p><p class = "ids">envia</p><p class = "simbolo">(</p><p class = "ids">ok</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <br/>    <p class = "reservada">return</p> <p class = "numero">0</p><p class = "simbolo">;</p><br/><p class = "simbolo">}</p><br/><br/><p class = "tipodato">int</p> <p class = "ids">rdonly_File</p><p class = "simbolo">(</p><p class = "tipodato">char</p> <p class = "sinClass">*</p><p class = "ids">name</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>    <p class = "tipodato">int</p> <p class = "ids">id_File</p><p class = "simbolo">;</p><br/>    <p class = "reservada">if</p> <p class = "simbolo">(</p><p class = "simbolo">(</p><p class = "ids">id_File</p> <p class = "operador">=</p> <p class = "ids">open</p><p class = "simbolo">(</p><p class = "ids">name</p><p class = "simbolo">,</p> <p class = "ids">O_RDONLY</p><p class = "simbolo">)</p><p class = "simbolo">)</p> <p class = "sinClass">!</p><p class = "operador">=</p> <p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p> <p class = "simbolo">{</p><br/>        <p class = "ids">cout</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "constantechar">"Accediendo a : "</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "ids">name</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "ids">endl</p><p class = "simbolo">;</p><br/>        <p class = "reservada">return</p> <p class = "ids">id_File</p><p class = "simbolo">;</p><br/>    <p class = "simbolo">}</p><p class = "reservada">else</p><p class = "simbolo">{</p><br/>        <p class = "ids">perror</p><p class = "simbolo">(</p><p class = "constantechar">"Ocurrio un error al intentar abrir el archivo en modo lectura"</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>        <p class = "ids">exit</p><p class = "simbolo">(</p><p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "simbolo">}</p><br/><p class = "simbolo">}</p><br/><br/><p class = "tipodato">int</p> <p class = "ids">wronly_File</p><p class = "simbolo">(</p><p class = "tipodato">char</p> <p class = "sinClass">*</p><p class = "ids">name</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>    <p class = "tipodato">int</p> <p class = "ids">id_File</p><p class = "simbolo">;</p><br/>    <p class = "reservada">if</p> <p class = "simbolo">(</p><p class = "simbolo">(</p><p class = "ids">id_File</p> <p class = "operador">=</p> <p class = "ids">open</p><p class = "simbolo">(</p><p class = "ids">name</p><p class = "simbolo">,</p> <p class = "ids">O_WRONLY</p><p class = "simbolo">)</p><p class = "simbolo">)</p> <p class = "sinClass">!</p><p class = "operador">=</p> <p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p> <p class = "simbolo">{</p><br/>        <p class = "reservada">return</p> <p class = "ids">id_File</p><p class = "simbolo">;</p><br/>    <p class = "simbolo">}</p><p class = "reservada">else</p><p class = "simbolo">{</p><br/>        <p class = "ids">perror</p><p class = "simbolo">(</p><p class = "constantechar">"Ocurrio un error al intentar abrir el archivo en modo escritura"</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>        <p class = "ids">exit</p><p class = "simbolo">(</p><p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "simbolo">}</p><br/><p class = "simbolo">}</p><br/><br/><p class = "tipodato">int</p> <p class = "ids">create_File</p><p class = "simbolo">(</p><p class = "tipodato">char</p> <p class = "sinClass">*</p><p class = "ids">name</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>    <p class = "tipodato">int</p> <p class = "ids">id_File</p><p class = "simbolo">;</p><br/>    <p class = "reservada">if</p><p class = "simbolo">(</p><p class = "simbolo">(</p><p class = "ids">id_File</p> <p class = "operador">=</p> <p class = "ids">open</p><p class = "simbolo">(</p><p class = "ids">name</p><p class = "simbolo">,</p> <p class = "ids">O_CREAT</p><p class = "sinClass">|</p><p class = "ids">O_EXCL</p><p class = "simbolo">,</p> <p class = "numero">0666</p><p class = "simbolo">)</p><p class = "simbolo">)</p> <p class = "sinClass">!</p><p class = "operador">=</p> <p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p><p class = "simbolo">{</p><br/>        <p class = "ids">cout</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "constantechar">"El archivo "</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "ids">name</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "constantechar">" se creo/abrio"</p> <p class = "operador"><</p><p class = "operador"><</p> <p class = "ids">endl</p><p class = "simbolo">;</p><br/>        <p class = "reservada">return</p> <p class = "ids">id_File</p><p class = "simbolo">;</p><br/>    <p class = "simbolo">}</p><p class = "reservada">else</p><p class = "simbolo">{</p><br/>        <p class = "ids">perror</p><p class = "simbolo">(</p><p class = "constantechar">"Ocurrio un error con el archivo"</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>        <p class = "ids">exit</p><p class = "simbolo">(</p><p class = "operador">-</p><p class = "numero">1</p><p class = "simbolo">)</p><p class = "simbolo">;</p><br/>    <p class = "simbolo">}</p><br/><p class = "simbolo">}</p><br/>
   </body>
 </html>